# DailyTask v3.0.4 完整指令列表

## 📋 指令总览

**当前版本**：v3.0.4  
**指令总数**：23 个  
**指令分类**：5 大类

---

## 🎯 完整指令清单

### 1️⃣ 任务管理类（7个指令）

#### 1.1 启动任务
**指令格式**：
```
指令:启动
指令:启动任务
指令:开始打卡
#启动
启动（精确匹配）
```

**功能说明**：
- 立即启动日常打卡任务循环
- 按照已配置的任务时间点依次执行
- 启动后会发送确认邮件

**实现位置**：`NotificationMonitorService.kt` - 行138-148  
**实现方式**：
```kotlin
BroadcastManager.getDefault().sendBroadcast(
    this, MessageType.START_DAILY_TASK.action
)
```

**邮件通知**：
- 标题：`任务启动确认`
- 内容：`收到启动指令，任务已启动。来源: [包名]`

---

#### 1.2 停止任务
**指令格式**：
```
指令:停止
指令:停止任务
指令:停止打卡
#停止
停止（精确匹配）
```

**功能说明**：
- 立即停止当前运行的打卡任务循环
- 取消所有待执行的任务
- 停止后会发送确认邮件

**实现位置**：`NotificationMonitorService.kt` - 行150-160  
**实现方式**：
```kotlin
BroadcastManager.getDefault().sendBroadcast(
    this, MessageType.STOP_DAILY_TASK.action
)
```

**邮件通知**：
- 标题：`任务停止确认`
- 内容：`收到停止指令，任务已停止。来源: [包名]`

---

#### 1.3 添加任务
**指令格式**：
```
指令:添加任务 HH:mm
#添加任务 HH:mm
```

**参数说明**：
- `HH:mm`：24小时制时间格式
- 小时范围：00-23
- 分钟范围：00-59

**示例**：
```
指令:添加任务 09:00    ← 添加早上9点打卡
指令:添加任务 18:30    ← 添加下午6点半打卡
#添加任务 12:00        ← 添加中午12点打卡
```

**功能说明**：
- 添加新的打卡时间点到任务列表
- 自动检查时间格式合法性
- 自动检查任务是否已存在（防重复）
- 添加成功后显示所有任务列表

**实现位置**：`NotificationMonitorService.kt` - 行219-264  
**验证逻辑**：
1. 参数数量检查（至少2个参数）
2. 时间格式验证（正则：`^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$`）
3. 任务重复检查（`DatabaseWrapper.isTaskTimeExist(time)`）

**邮件通知**：
- 成功标题：`添加任务成功`
- 成功内容：`已成功添加打卡任务：[时间]\n\n当前所有任务：\n[任务列表]`
- 失败标题：`添加任务失败`
- 失败内容：格式错误/时间格式错误/任务已存在/执行出错

---

#### 1.4 修改任务
**指令格式**：
```
指令:修改任务 旧时间 新时间
指令:修改任务 旧时间->新时间
#修改任务 旧时间 新时间
```

**参数说明**：
- `旧时间`：要修改的任务时间（必须存在）
- `新时间`：修改后的时间（不能与其他任务冲突）
- 支持空格或箭头（`->`/`→`）分隔

**示例**：
```
指令:修改任务 09:00 09:15      ← 将9点改为9点15分
指令:修改任务 18:00->18:30     ← 将6点改为6点半
#修改任务 12:00 12:30          ← 将12点改为12点半
```

**功能说明**：
- 修改已存在的打卡时间点
- 自动检查旧时间是否存在
- 自动检查新时间是否与其他任务冲突
- 修改成功后显示所有任务列表

**实现位置**：`NotificationMonitorService.kt` - 行266-326  
**验证逻辑**：
1. 参数数量检查（至少3个参数）
2. 两个时间格式都验证
3. 旧任务存在性检查
4. 新时间冲突检查（如果新旧时间不同）

**邮件通知**：
- 成功标题：`修改任务成功`
- 成功内容：`已将任务时间从 [旧时间] 修改为 [新时间]\n\n当前所有任务：\n[任务列表]`
- 失败标题：`修改任务失败`
- 失败内容：格式错误/时间格式错误/任务不存在/时间冲突/执行出错

---

#### 1.5 删除任务
**指令格式**：
```
指令:删除任务 HH:mm
#删除任务 HH:mm
```

**参数说明**：
- `HH:mm`：要删除的任务时间（必须存在）

**示例**：
```
指令:删除任务 09:00    ← 删除早上9点的任务
指令:删除任务 18:30    ← 删除下午6点半的任务
#删除任务 12:00        ← 删除中午12点的任务
```

**功能说明**：
- 删除指定的打卡时间点
- 自动检查任务是否存在
- 删除成功后显示剩余任务列表

**实现位置**：`NotificationMonitorService.kt` - 行328-365  
**验证逻辑**：
1. 参数数量检查（至少2个参数）
2. 任务存在性检查

**邮件通知**：
- 成功标题：`删除任务成功`
- 成功内容：`已成功删除任务：[时间]\n\n剩余任务：\n[任务列表]`
- 失败标题：`删除任务失败`
- 失败内容：格式错误/任务不存在/执行出错

---

#### 1.6 查询任务
**指令格式**：
```
指令:查询任务
指令:任务列表
#任务列表
#查询任务
查询任务（精确匹配）
```

**功能说明**：
- 查询所有已配置的打卡任务
- 按时间顺序排序显示
- 显示任务总数

**实现位置**：`NotificationMonitorService.kt` - 行367-384  
**返回格式**：
```
当前共有 [数量] 个打卡任务：

1. 09:00
2. 13:00
3. 18:00

提示：发送'指令:添加任务 HH:mm'可添加新任务
```

**邮件通知**：
- 标题：`任务列表查询`
- 内容：任务总数 + 任务列表 + 提示信息
- 无任务时显示：`暂无任务`

---

#### 1.7 重试打卡
**指令格式**：
```
指令:重试打卡
#重试打卡
重试打卡（精确匹配）
```

**功能说明**：
- 立即触发一次打卡操作
- 不等待定时任务
- 手动触发打卡流程

**使用场景**：
- 打卡失败需要手动重试
- 临时需要补打卡
- 测试打卡功能

**实现位置**：`NotificationMonitorService.kt` - 行200-208  
**实现方式**：
```kotlin
openApplication(true)  // 直接打开钉钉应用
```

**邮件通知**：
- 标题：`重试打卡通知`
- 内容：`已收到远程指令，正在尝试重新打卡`

---

### 2️⃣ 系统管理类（4个指令）

#### 2.1 开始循环
**指令格式**：
```
指令:开始循环
#开始循环
开始循环（精确匹配）
```

**功能说明**：
- 启用任务自动启动功能
- 工作日 7:00-10:00 会自动检测并启动任务
- 使用 TaskAutoStartService 后台检测

**实现位置**：`NotificationMonitorService.kt` - 行162-167  
**实现方式**：
```kotlin
SaveKeyValues.putValue(Constant.TASK_AUTO_START_KEY, true)
```

**邮件通知**：
- 标题：`循环任务状态通知`
- 内容：`循环任务状态已更新为：开启`

**相关服务**：
- `TaskAutoStartService`：每5分钟检查一次
- 检查时间范围：7:00-10:00
- 仅在工作日执行（支持节假日判断）

---

#### 2.2 暂停循环
**指令格式**：
```
指令:暂停循环
#暂停循环
暂停循环（精确匹配）
```

**功能说明**：
- 禁用任务自动启动功能
- 不会自动启动任务，需手动发送"启动"指令
- 适用于出差、休假等场景

**实现位置**：`NotificationMonitorService.kt` - 行169-174  
**实现方式**：
```kotlin
SaveKeyValues.putValue(Constant.TASK_AUTO_START_KEY, false)
```

**邮件通知**：
- 标题：`循环任务状态通知`
- 内容：`循环任务状态已更新为：暂停`

---

#### 2.3 重启应用
**指令格式**：
```
指令:重启应用
指令:重启
#重启应用
#重启
重启（精确匹配）
```

**功能说明**：
- 远程重启 DailyTask 应用
- 3秒后自动重启
- 杀死当前进程并重新启动

**使用场景**：
- 应用出现异常需要重启
- 配置修改后需要重启生效
- 强制刷新应用状态

**实现位置**：`NotificationMonitorService.kt` - 行399-424  
**实现流程**：
1. 发送邮件通知（即将重启）
2. 延迟3秒（确保邮件发送完成）
3. 获取启动 Intent
4. 添加清除栈顶标志
5. 启动应用
6. 杀死当前进程

**邮件通知**：
- 标题：`应用重启通知`
- 内容：`已收到重启指令，应用将在3秒后重启...`

**注意事项**：
- ⚠️ 重启期间可能丢失未保存的数据
- ⚠️ 某些设备可能重启失败（建议v3.1.0改用AlarmManager）

---

#### 2.4 查询配置
**指令格式**：
```
指令:查询配置
指令:配置信息
#查询配置
#配置信息
查询配置（精确匹配）
```

**功能说明**：
- 查看所有系统配置信息
- 包含超时、自动启动、任务名称等
- 显示当前配置状态

**实现位置**：`NotificationMonitorService.kt` - 行426-464  
**查询的配置项**：
1. 打卡超时时间（STAY_DD_TIMEOUT_KEY）
2. 自动启动任务（TASK_AUTO_START_KEY）
3. 任务名称关键词（TASK_NAME_KEY）
4. 每日重置时间（RESET_TIME_KEY）
5. 随机时间（RANDOM_TIME_KEY）
6. 周末打卡（ENABLE_WEEKEND_KEY）
7. 节假日打卡（ENABLE_HOLIDAY_KEY）
8. 任务数量（从数据库查询）

**返回格式**：
```
【系统配置信息】

⏱ 打卡超时时间：30秒
🔄 自动启动任务：已开启
📝 任务名称关键词：打卡
🕐 每日重置时间：0:00
🎲 随机时间：已关闭
📅 周末打卡：已关闭
🎊 节假日打卡：已关闭

📋 任务数量：3个

提示：发送'指令:修改超时 秒数'可修改超时时间
```

**邮件通知**：
- 标题：`系统配置查询`
- 内容：完整的配置信息

---

#### 2.5 修改超时时间
**指令格式**：
```
指令:修改超时 秒数
#修改超时 秒数
```

**参数说明**：
- `秒数`：超时时间（10-300秒）
- 默认值：30秒

**示例**：
```
指令:修改超时 45    ← 设置为45秒
指令:修改超时 60    ← 设置为60秒
#修改超时 90        ← 设置为90秒
```

**功能说明**：
- 调整打卡页面停留的超时时长
- 超时后会自动返回主界面
- 立即生效，无需重启

**实现位置**：`NotificationMonitorService.kt` - 行466-503  
**验证逻辑**：
1. 参数数量检查（至少2个参数）
2. 参数类型检查（必须是整数）
3. 参数范围检查（10-300秒）

**邮件通知**：
- 成功标题：`修改超时时间成功`
- 成功内容：`已将打卡超时时间修改为：[秒数] 秒`
- 失败标题：`修改超时时间失败`
- 失败内容：格式错误/参数范围错误/执行出错

---

### 3️⃣ 状态查询类（5个指令）

#### 3.1 查询电量
**指令格式**：
```
指令:电量
#电量
电量（精确匹配）
```

**功能说明**：
- 查询当前手机剩余电量百分比
- 使用系统 BatteryManager 获取

**实现位置**：`NotificationMonitorService.kt` - 行129-136  
**实现方式**：
```kotlin
val capacity = batteryManager.getIntProperty(
    BatteryManager.BATTERY_PROPERTY_CAPACITY
)
```

**邮件通知**：
- 标题：`查询手机电量通知`
- 内容：`当前手机剩余电量为：[百分比]%`

---

#### 3.2 查询考勤记录
**指令格式**：
```
指令:考勤记录
#考勤记录
#考勤
考勤记录（精确匹配）
```

**功能说明**：
- 查询今天所有的考勤打卡记录
- 从数据库读取当天通知记录
- 按时间顺序显示

**实现位置**：`NotificationMonitorService.kt` - 行188-198  
**返回格式**：
```
【第1次】考勤打卡成功，时间：2026-02-06 09:02:34
【第2次】考勤打卡成功，时间：2026-02-06 18:01:22
```

**邮件通知**：
- 标题：`当天考勤记录通知`
- 内容：所有考勤记录列表
- 无记录时显示空内容

---

#### 3.3 查询应用状态
**指令格式**：
```
指令:应用状态
指令:状态
#应用状态
#状态
应用状态（精确匹配）
```

**功能说明**：
- 查询应用运行状态摘要
- 包含电量、任务状态、任务数量、通知数量、当前时间等

**实现位置**：`NotificationMonitorService.kt` - 行505-534  
**返回信息**：
1. 设备电量（BatteryManager）
2. 任务运行状态（task_is_running）
3. 任务数量（数据库查询）
4. 今日通知数量（数据库查询）
5. 当前时间（时间戳转换）

**返回格式**：
```
【应用运行状态】

📱 设备电量：85%
▶️ 任务状态：运行中
📋 任务数量：3个
📝 今日通知：5条
⏰ 当前时间：2026-02-06 14:30:15

提示：发送'指令:查询任务'可查看所有任务
```

**邮件通知**：
- 标题：`应用状态查询`
- 内容：完整的状态摘要

---

#### 3.4 查询日志
**指令格式**：
```
指令:日志查询
指令:日志查询 行数
#日志查询
#日志查询 行数
```

**参数说明**：
- `行数`：可选，默认10行
- 建议范围：1-50行

**示例**：
```
指令:日志查询        ← 查询最近10条日志
指令:日志查询 20     ← 查询最近20条日志
#日志查询 30         ← 查询最近30条日志
```

**功能说明**：
- 查询应用运行日志
- 显示最近N条日志记录
- 用于排查问题和调试

**实现位置**：`NotificationMonitorService.kt` - 行536-556  
**日志读取**：`LogFileManager.readLastLogs(lines)`

**邮件通知**：
- 标题：`日志查询结果`
- 内容：`最近 [行数] 条日志：\n\n[日志内容]`

**注意事项**：
- ⚠️ 日志文件较大时（>5MB）读取可能较慢（1-2秒）
- 📝 建议不要一次查询过多行（建议<50行）

---

#### 3.5 查询版本信息
**指令格式**：
```
指令:版本信息
指令:版本
#版本信息
#版本
版本信息（精确匹配）
```

**功能说明**：
- 查询当前应用版本号
- 显示版本名称和构建号
- 包含GitHub仓库链接

**实现位置**：`NotificationMonitorService.kt` - 行558-580  
**返回信息**：
1. 应用名称：DailyTask
2. 版本号（VERSION_NAME）
3. 构建号（VERSION_CODE）
4. 当前日期时间
5. GitHub仓库地址

**返回格式**：
```
【版本信息】

📦 应用名称：DailyTask
🏷 版本号：3.0.4
🔢 构建号：3004
📅 当前日期：2026-02-06 14:30:15

GitHub: https://github.com/xiaohuai3344/DailyTask-master3344
```

**邮件通知**：
- 标题：`版本信息查询`
- 内容：完整的版本信息

---

### 4️⃣ 显示控制类（3个指令）

#### 4.1 息屏
**指令格式**：
```
指令:息屏
#息屏
息屏（精确匹配）
```

**功能说明**：
- 显示伪灭屏遮罩层
- 隐藏屏幕内容
- 适用于打卡时不想被看到

**实现位置**：`NotificationMonitorService.kt` - 行176-180  
**实现方式**：
```kotlin
BroadcastManager.getDefault().sendBroadcast(
    this, MessageType.SHOW_MASK_VIEW.action
)
```

**相关服务**：`FloatingWindowService` - 显示黑色遮罩层

---

#### 4.2 亮屏
**指令格式**：
```
指令:亮屏
#亮屏
亮屏（精确匹配）
```

**功能说明**：
- 隐藏伪灭屏遮罩层
- 恢复正常显示
- 取消息屏状态

**实现位置**：`NotificationMonitorService.kt` - 行182-186  
**实现方式**：
```kotlin
BroadcastManager.getDefault().sendBroadcast(
    this, MessageType.HIDE_MASK_VIEW.action
)
```

---

#### 4.3 延迟息屏
**指令格式**：
```
指令:延迟息屏 秒数
#延迟息屏 秒数
```

**参数说明**：
- `秒数`：延迟时间（1-60秒）

**示例**：
```
指令:延迟息屏 10    ← 10秒后息屏
指令:延迟息屏 30    ← 30秒后息屏
#延迟息屏 5         ← 5秒后息屏
```

**功能说明**：
- 设定N秒后自动显示息屏遮罩
- 使用 Handler 延迟执行
- 适用于需要看完某些内容后再息屏

**实现位置**：`NotificationMonitorService.kt` - 行582-621  
**验证逻辑**：
1. 参数数量检查（至少2个参数）
2. 参数类型检查（必须是整数）
3. 参数范围检查（1-60秒）

**实现方式**：
```kotlin
Handler(Looper.getMainLooper()).postDelayed({
    BroadcastManager.getDefault().sendBroadcast(
        this, MessageType.SHOW_MASK_VIEW.action
    )
}, delay * 1000L)
```

**邮件通知**：
- 成功标题：`延迟息屏设置成功`
- 成功内容：`将在 [秒数] 秒后自动息屏`
- 失败标题：`延迟息屏失败`
- 失败内容：格式错误/参数范围错误/执行出错

---

### 5️⃣ 帮助文档类（1个指令）

#### 5.1 帮助
**指令格式**：
```
指令:帮助
#help
help（精确匹配）
```

**功能说明**：
- 显示完整的指令帮助文档
- 包含所有指令的说明和示例
- 按分类组织

**实现位置**：`NotificationMonitorService.kt` - 行623-651  
**返回内容**：
```
【远程指令帮助】

指令格式：指令:<command> [参数]

【任务控制】
• 启动/停止 - 启动/停止打卡任务
• 添加任务 HH:mm - 添加新任务
• 修改任务 旧时间 新时间
• 删除任务 HH:mm
• 查询任务 - 查看所有任务
• 重试打卡 - 立即重试

【系统管理】
• 开始循环/暂停循环
• 重启应用
• 修改超时 秒数
• 查询配置

【状态查询】
• 电量
• 考勤记录
• 应用状态
• 日志查询 [行数]
• 版本信息

【显示控制】
• 息屏/亮屏
• 延迟息屏 秒数

示例：
指令:添加任务 09:00
指令:修改超时 45
#查询任务
```

**邮件通知**：
- 标题：`远程指令帮助文档`
- 内容：完整的指令列表和说明

---

## 📊 指令统计汇总

### 按功能分类

| 分类 | 指令数量 | 指令列表 |
|------|---------|---------|
| **任务管理** | 7 | 启动、停止、添加、修改、删除、查询、重试 |
| **系统管理** | 4 | 开始循环、暂停循环、重启、配置、修改超时 |
| **状态查询** | 5 | 电量、考勤、应用状态、日志、版本 |
| **显示控制** | 3 | 息屏、亮屏、延迟息屏 |
| **帮助文档** | 1 | 帮助 |
| **原有指令** | 3 | 任务名称触发 |
| **总计** | **23** | - |

### 按参数类型分类

| 参数类型 | 指令数量 | 说明 |
|---------|---------|------|
| **无参数** | 14 | 启动、停止、查询任务、重试打卡、开始循环、暂停循环、重启、查询配置、电量、考勤记录、应用状态、版本信息、息屏、亮屏、帮助 |
| **必选参数** | 5 | 添加任务、修改任务、删除任务、修改超时、延迟息屏 |
| **可选参数** | 1 | 日志查询 |
| **总计** | **20** | （不含原有的3个指令） |

### 按实现版本分类

| 版本 | 新增指令 | 累计指令 |
|------|---------|---------|
| v3.0.0 及之前 | 8 | 8 |
| v3.0.4 | +15 | 23 |

---

## 🔒 安全机制

### 指令来源验证
**仅接受以下5个应用的通知**：
1. 微信（com.tencent.mm）
2. 企业微信（com.tencent.wework）
3. QQ（com.tencent.mobileqq）
4. TIM（com.tencent.tim）
5. 支付宝（com.eg.android.AlipayGphone）

### 指令格式验证
**支持3种格式**：
1. `指令:<command>` - 推荐格式
2. `#<command>` - 简洁格式
3. `<command>` - 精确匹配（仅限无参数指令）

### 参数验证
**三重验证**：
1. **格式验证**：时间格式、参数类型
2. **范围验证**：参数数值范围
3. **逻辑验证**：业务逻辑合法性

### 频率限制
- 同类型邮件 60 秒内只发送一次
- 防止指令洪泛攻击

---

## 💡 使用建议

### 推荐使用场景

#### 场景1：每日检查
```
早上（08:00）：
1. 指令:应用状态
2. 指令:电量

晚上（19:00）：
1. 指令:考勤记录
2. 指令:日志查询
```

#### 场景2：任务管理
```
临时加班：指令:添加任务 18:30
作息调整：指令:修改任务 09:00 08:30
出差暂停：指令:暂停循环
```

#### 场景3：问题排查
```
打卡失败后：
1. 指令:日志查询 30
2. 指令:重试打卡
3. 指令:应用状态
```

---

## 🔗 相关文档

- **用户指南**：[REMOTE_COMMANDS_USER_GUIDE.md](https://github.com/xiaohuai3344/DailyTask-master3344/blob/master/REMOTE_COMMANDS_USER_GUIDE.md) - 6700字详细教程
- **快速参考**：[REMOTE_COMMANDS_QUICK_REFERENCE.md](https://github.com/xiaohuai3344/DailyTask-master3344/blob/master/REMOTE_COMMANDS_QUICK_REFERENCE.md) - 速查手册
- **设计文档**：[REMOTE_COMMANDS_DESIGN.md](https://github.com/xiaohuai3344/DailyTask-master3344/blob/master/REMOTE_COMMANDS_DESIGN.md) - 系统设计
- **实现总结**：[V3.0.4_IMPLEMENTATION_SUMMARY.md](https://github.com/xiaohuai3344/DailyTask-master3344/blob/master/V3.0.4_IMPLEMENTATION_SUMMARY.md) - 技术细节

---

**文档版本**：v1.0  
**创建日期**：2026-02-06  
**适用版本**：DailyTask v3.0.4+  
**指令总数**：23 个

**✨ DailyTask - 让打卡管理更智能、更便捷！✨**
